---

title: K Fold Validation 

keywords: fastai
sidebar: home_sidebar

summary: "Aggregates the K fold validation to the pipeline classifier. "
description: "Aggregates the K fold validation to the pipeline classifier. "
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02_k_fold_validation.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To assess the performance of the model the, sklearn K fold validation  method is incorporated. After running the <em>k-fold</em> method the averaged scores are computed.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Sklearn-K-Fold-Validation">Sklearn K Fold Validation<a class="anchor-link" href="#Sklearn-K-Fold-Validation"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="k_fold_validation" class="doc_header"><code>k_fold_validation</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/k_fold_validation.py#L22" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>k_fold_validation</code>(<strong><code>X</code></strong>, <strong><code>n_splits</code></strong>=<em><code>4</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check the train and test set splitting of of equal size</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="k">for</span> <span class="n">train</span><span class="p">,</span><span class="n">test</span> <span class="ow">in</span> <span class="n">k_fold_validation</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)),</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Average-over-scores">Average over scores<a class="anchor-link" href="#Average-over-scores"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="score_averages" class="doc_header"><code>score_averages</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/k_fold_validation.py#L29" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>score_averages</code>(<strong>**<code>k_fold_evaluations</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Consider the case of two folds in a train set with 'acc' and 'f1' scores</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rnd1</span><span class="p">,</span> <span class="n">rnd2</span><span class="p">,</span> <span class="n">rnd3</span><span class="p">,</span> <span class="n">rnd4</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
<span class="n">fold1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;train&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;acc&#39;</span><span class="p">:</span> <span class="n">rnd1</span><span class="p">,</span> <span class="s1">&#39;f1&#39;</span><span class="p">:</span> <span class="n">rnd2</span><span class="p">}}</span>
<span class="n">fold2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;train&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;acc&#39;</span><span class="p">:</span> <span class="n">rnd3</span><span class="p">,</span> <span class="s1">&#39;f1&#39;</span><span class="p">:</span> <span class="n">rnd4</span><span class="p">}}</span>
<span class="n">avg_acc</span><span class="p">,</span> <span class="n">avg_f1</span> <span class="o">=</span> <span class="p">(</span><span class="n">rnd1</span> <span class="o">+</span> <span class="n">rnd3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">rnd2</span> <span class="o">+</span> <span class="n">rnd4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">train_score_avgs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;train&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;acc&#39;</span><span class="p">:</span> <span class="n">avg_acc</span><span class="p">,</span> <span class="s1">&#39;f1&#39;</span><span class="p">:</span> <span class="n">avg_f1</span><span class="p">}}</span>

<span class="k">assert</span> <span class="n">score_averages</span><span class="p">(</span><span class="n">fold1</span><span class="o">=</span><span class="n">fold1</span><span class="p">,</span> <span class="n">fold2</span><span class="o">=</span><span class="n">fold2</span><span class="p">)</span> <span class="o">==</span> <span class="n">train_score_avgs</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="KFoldPipeline" class="doc_header"><code>class</code> <code>KFoldPipeline</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/k_fold_validation.py#L47" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>KFoldPipeline</code>(<strong><code>dataset_file</code></strong>, <strong><code>n_splits</code></strong>=<em><code>4</code></em>) :: <a href="/job_offer_classifier/pipeline_classifier#Pipeline"><code>Pipeline</code></a></p>
</blockquote>
<p>K fold validation over the model built in <a href="/job_offer_classifier/pipeline_classifier#Pipeline"><code>Pipeline</code></a> class</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="KFoldPipeline.k_fold_validation" class="doc_header"><code>KFoldPipeline.k_fold_validation</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/k_fold_validation.py#L55" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>KFoldPipeline.k_fold_validation</code>()</p>
</blockquote>
<p>Implements the <code>pipeline</code> method for each fold.
The averaged score is stored in <code>avg_evaluation</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>The case $k=1$</em><br>
This case is used to check the pipeline (through the info logging)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kfp</span> <span class="o">=</span> <span class="n">KFoldPipeline</span><span class="p">(</span><span class="n">dataset_file</span><span class="o">=</span><span class="s1">&#39;../data/interim/payloads.csv&#39;</span><span class="p">,</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">kfp</span><span class="o">.</span><span class="n">train_steps</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">kfp</span><span class="o">.</span><span class="n">k_fold_validation</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>08:58:14 INFO: Using /tmp/tfhub_modules to cache modules.
08:58:26 INFO: fold 1 has finished...
08:58:26 INFO: The accuracy score for the training set in fold 1 is 1.0
08:58:26 INFO: The f1_score score for the training set in fold 1 is 1.0
08:58:38 INFO: fold 2 has finished...
08:58:38 INFO: The accuracy score for the training set in fold 2 is 0.8296703
08:58:38 INFO: The f1_score score for the training set in fold 2 is 0.8724279570683305
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><em>The case $k=4$</em><br>
This case represents the actual assesment of the model perfomance</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kfp</span> <span class="o">=</span> <span class="n">KFoldPipeline</span><span class="p">(</span><span class="n">dataset_file</span><span class="o">=</span><span class="s1">&#39;../data/interim/payloads.csv&#39;</span><span class="p">,</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">kfp</span><span class="o">.</span><span class="n">train_steps</span> <span class="o">=</span> <span class="mi">5000</span> <span class="c1">#default</span>
<span class="n">kfp</span><span class="o">.</span><span class="n">k_fold_validation</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>09:17:30 INFO: fold 1 has finished...
09:17:30 INFO: The accuracy score for the training set in fold 1 is 0.99655175
09:17:30 INFO: The f1_score score for the training set in fold 1 is 0.9979633420684656
09:18:06 INFO: fold 2 has finished...
09:18:06 INFO: The accuracy score for the training set in fold 2 is 0.98275864
09:18:06 INFO: The f1_score score for the training set in fold 2 is 0.9905482064335733
09:18:43 INFO: fold 3 has finished...
09:18:43 INFO: The accuracy score for the training set in fold 3 is 0.9862069
09:18:43 INFO: The f1_score score for the training set in fold 3 is 0.9908257247813479
09:19:24 INFO: fold 4 has finished...
09:19:24 INFO: The accuracy score for the training set in fold 4 is 0.9862543
09:19:24 INFO: The f1_score score for the training set in fold 4 is 0.9908675778009323
09:20:03 INFO: fold 5 has finished...
09:20:03 INFO: The accuracy score for the training set in fold 5 is 0.9862543
09:20:03 INFO: The f1_score score for the training set in fold 5 is 0.9908675778009323
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The  averaged evaluation is in <code>avg_evaluation</code> atrribute</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kfp</span><span class="o">.</span><span class="n">avg_evaluation</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;accuracy&#39;: 0.9876051664352417,
 &#39;accuracy_baseline&#39;: 0.7989667177200317,
 &#39;auc&#39;: 0.9924227833747864,
 &#39;auc_precision_recall&#39;: 0.9978546500205994,
 &#39;average_loss&#39;: 0.0626331850886345,
 &#39;label/mean&#39;: 0.7989667177200317,
 &#39;loss&#39;: 0.05038395039737224,
 &#39;precision&#39;: 0.9872474074363708,
 &#39;prediction/mean&#39;: 0.799962329864502,
 &#39;recall&#39;: 0.9972434759140014,
 &#39;global_step&#39;: 5000.0,
 &#39;f1_score&#39;: 0.9922144857770503}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kfp</span><span class="o">.</span><span class="n">avg_evaluation</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;accuracy&#39;: 0.9259893417358398,
 &#39;accuracy_baseline&#39;: 0.8465753316879272,
 &#39;auc&#39;: 0.36761903762817383,
 &#39;auc_precision_recall&#39;: 0.9573580622673035,
 &#39;average_loss&#39;: 0.1822646100074053,
 &#39;label/mean&#39;: 0.7999999940395355,
 &#39;loss&#39;: 0.1822646100074053,
 &#39;precision&#39;: 0.9399641513824463,
 &#39;prediction/mean&#39;: 0.7845720887184143,
 &#39;recall&#39;: 0.920714282989502,
 &#39;global_step&#39;: 5000.0,
 &#39;f1_score&#39;: 0.9279590007548488}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

