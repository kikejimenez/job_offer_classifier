---

title: Pipeline 

keywords: fastai
sidebar: home_sidebar

summary: "Pipeline of the text binary classifier for job offer email responses "
description: "Pipeline of the text binary classifier for job offer email responses "
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_pipeline_classifier.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The emails are classified as 'positive' or 'negative' using the Tensorflow <code>tf.estimator</code> module.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-Processing">Data Processing<a class="anchor-link" href="#Data-Processing"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The dataset of email responses is loaded from a csv file.  Three steps make up the data processing pipeline:<br>
Load the data --&gt;  Make train-test split  --&gt;  Create the Tensorflow input functions</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Load and split the data using the Pandas library.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split_dataframe" class="doc_header"><code>split_dataframe</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L25" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split_dataframe</code>(<strong><code>df</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Split with the pandas <code>sample</code> method.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="balanced_labels_in_split" class="doc_header"><code>balanced_labels_in_split</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L34" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>balanced_labels_in_split</code>(<strong><code>df</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Give a balanced train-test split in 'positive' and 'negative' labels</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test these function with the following example</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sentiments</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sentiment</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sentiment&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">sentiment</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]}</span>
<span class="n">df_example_f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sentiment</span><span class="p">,</span> <span class="n">ni</span><span class="p">,</span> <span class="n">nf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">sentiments</span><span class="p">(</span><span class="n">sentiment</span><span class="p">,</span> <span class="n">nf</span> <span class="o">-</span> <span class="n">ni</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span> <span class="n">nf</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nf</span> <span class="o">-</span> <span class="n">ni</span><span class="p">)</span>
<span class="n">df_a</span> <span class="o">=</span>  <span class="n">df_example_f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="c1"># positive</span>
<span class="n">df_b</span> <span class="o">=</span> <span class="n">df_example_f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span> <span class="c1"># negative</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">random_state</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="p">)</span>
<span class="n">split_aa</span> <span class="o">=</span> <span class="n">split_dataframe</span><span class="p">(</span><span class="n">df_a</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="n">frac</span><span class="o">=.</span><span class="mi">55</span><span class="p">)</span>
<span class="n">split_bb</span> <span class="o">=</span> <span class="n">split_dataframe</span><span class="p">(</span><span class="n">df_a</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="n">frac</span><span class="o">=.</span><span class="mi">55</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">split_aa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">split_bb</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">split_dataframe</span><span class="p">(</span><span class="n">df_a</span><span class="p">,</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">train</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">70</span> <span class="ow">and</span> <span class="n">test</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">30</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_a</span><span class="p">,</span> <span class="n">df_b</span><span class="p">])</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">balanced_labels_in_split</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">frac</span><span class="o">=.</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

<span class="k">assert</span> <span class="n">dataset</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">train</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">test</span><span class="o">.</span><span class="n">size</span>
<span class="k">assert</span> <span class="n">train</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">dataset</span><span class="o">.</span><span class="n">size</span>

<span class="n">random_state</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="p">)</span>
<span class="n">balanced1</span> <span class="o">=</span> <span class="n">balanced_labels_in_split</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="n">frac</span><span class="o">=.</span><span class="mi">65</span><span class="p">)</span>
<span class="n">balanced2</span> <span class="o">=</span> <span class="n">balanced_labels_in_split</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="n">frac</span><span class="o">=.</span><span class="mi">65</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">balanced1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">balanced2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Tensorflow input functions are the input elements of the Tensorflow algorithms.
These functions are created with the help of the <em>version 1</em> <code>tf.estimator,inputs</code> module</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="tf_input_fn" class="doc_header"><code>tf_input_fn</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L45" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>tf_input_fn</code>(<strong><code>df</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Load a TF function for a DataFrame</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="train_input_fs" class="doc_header"><code>train_input_fs</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L52" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>train_input_fs</code>(<strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>TF functions with parameters for training</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="predict_input_fs" class="doc_header"><code>predict_input_fs</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L60" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>predict_input_fs</code>(<strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>TF with with parameters for testing</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Load and split the dataset</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/interim/payloads.csv&#39;</span><span class="p">)</span>
<span class="n">dfs</span> <span class="o">=</span> <span class="n">balanced_labels_in_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Percentage of the positive and negative sentiments</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sentiment_rate</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="s1">&#39;sentiment: {negative: </span><span class="si">%s</span><span class="s1">, positive: </span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sentiment</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
    <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sentiment</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">size</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dataset --&gt;&#39;</span><span class="p">,</span><span class="n">sentiment_rate</span><span class="p">(</span><span class="n">df</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;train --&gt;&#39;</span><span class="p">,</span><span class="n">sentiment_rate</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]),</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test --&gt;&#39;</span><span class="p">,</span><span class="n">sentiment_rate</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]),</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>dataset --&gt;
sentiment: {negative: 0.10055096418732783, positive: 0.39944903581267216}
train --&gt;
sentiment: {negative: 0.10091743119266056, positive: 0.39908256880733944}
test --&gt;
sentiment: {negative: 0.1, positive: 0.4}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Sample of the train dataset</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>payload</th>
      <th>sentiment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>299</th>
      <td>thanks for your interest in my profile.\nhere ...</td>
      <td>1</td>
    </tr>
    <tr>
      <th>144</th>
      <td>i'm interested in working with your organizati...</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Load Tensorflow input functions</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_input_fn</span> <span class="o">=</span> <span class="n">train_input_fs</span><span class="p">(</span><span class="n">train</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">])</span>
<span class="n">predict_input_fn</span> <span class="o">=</span>  <span class="n">predict_input_fs</span><span class="p">(</span><span class="o">**</span><span class="n">dfs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Set-up-the-Model">Set up the Model<a class="anchor-link" href="#Set-up-the-Model"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><em>Feature columns</em></strong></p>
<p>From TF-Hub <a href="https://github.com/tensorflow/hub/blob/master/docs/api_docs/python/hub/text_embedding_column.md">feature column</a>
we use <a href="https://tfhub.dev/google/nnlm-en-dim128/1">nnlm-en-dim128 module</a>. Some important facts are:</p>
<ul>
<li>The module takes <strong>a batch of sentences in a 1-D tensor of strings</strong> as input.</li>
<li>The module is responsible for <strong>preprocessing of sentences</strong> (e.g. removal of punctuation and splitting on spaces).</li>
<li>The module works with any input (e.g. <strong>nnlm-en-dim128</strong> hashes words not present in vocabulary into ~20.000 buckets).</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="embedded_text_feature_column_f" class="doc_header"><code>embedded_text_feature_column_f</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L68" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>embedded_text_feature_column_f</code>(<strong><code>module_spec</code></strong>=<em><code>'https://tfhub.dev/google/nnlm-en-dim128/1'</code></em>)</p>
</blockquote>
<p>Call the text embedding from the TF-Hub library</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Load the embedded text feature column. If it's called it for the first time, it may take time to download it (it weights around 500 MB)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embedded_text_feature_column</span> <span class="o">=</span> <span class="n">embedded_text_feature_column_f</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><em>Premade Estimators</em></strong></p>
<p>For classification, we use a premade <a href="https://www.tensorflow.org/api_docs/python/tf/estimator/DNNClassifier">DNN Classifier</a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_estimator" class="doc_header"><code>load_estimator</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L76" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_estimator</code>(<strong><code>embedded_text_feature_column</code></strong>, <strong><code>estimator_f</code></strong>=<em><code>'DNNClassifierV2'</code></em>, <strong><code>model_dir</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Load the TF <code>estimator</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">estimator</span> <span class="o">=</span> <span class="n">load_estimator</span><span class="p">(</span><span class="n">embedded_text_feature_column</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When no <em>model_dir</em> is provided, the <code>estimator</code> is stored in a temporary file. A deletion of an  <code>estimator</code> (either explicit or by the garbage collector) does not erase its corresponding directory from the disk</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_dir</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">model_dir</span>
<span class="k">del</span> <span class="n">estimator</span> 
<span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
<span class="n">rmtree</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
<span class="n">estimator</span> <span class="o">=</span> <span class="n">load_estimator</span><span class="p">(</span><span class="n">embedded_text_feature_column</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Train,-Evaluate-and-Predict">Train, Evaluate and Predict<a class="anchor-link" href="#Train,-Evaluate-and-Predict"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Train the estimator for a reasonable amount of steps.<br>
Training for 5,000 steps means 640,000 training examples with the default
batch size (128).<br>
This is roughly equivalent to 640,000/363 ~ 1700 epochs since the training dataset
contains 363 examples.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="train" class="doc_header"><code>train</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L90" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>train</code>(<strong><code>estimator</code></strong>, <strong><code>train_input_fn</code></strong>, <strong><code>steps</code></strong>=<em><code>5000</code></em>)</p>
</blockquote>
<p>Train with TF <code>estimator.train</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span><span class="n">train_input_fn</span><span class="p">,</span><span class="n">steps</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;train&#39;: &lt;tensorflow_estimator.python.estimator.canned.dnn.DNNClassifierV2 at 0x7fefbfe86850&gt;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The F1 score is not included in <code>tf.estimator.evaluate</code>. The function <a href="/job_offer_classifier/pipeline_classifier#f1_score"><code>f1_score</code></a>, calculates the F1 score from the precision and recall. The function <a href="/job_offer_classifier/pipeline_classifier#evaluate"><code>evaluate</code></a> adds to  <code>tf.estimator.evaluate</code> the  <a href="/job_offer_classifier/pipeline_classifier#f1_score"><code>f1_score</code></a> and is acting over the input functions.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="f1_score" class="doc_header"><code>f1_score</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L99" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>f1_score</code>(<strong><code>estimations</code></strong>)</p>
</blockquote>
<p>Calculates function:</p>
<p><em>f1_score(precision,recall) =  (2 x precision x recall) / (precision + recall)</em></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">f1_score</span><span class="p">({</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">13</span><span class="p">),</span><span class="s1">&#39;recall&#39;</span><span class="p">:</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">13</span><span class="p">)})</span> <span class="o">==</span> <span class="mf">0.0</span>

<span class="k">assert</span> <span class="n">f1_score</span><span class="p">({</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;recall&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>  <span class="o">==</span> <span class="mf">1.</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="evaluate" class="doc_header"><code>evaluate</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L111" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>evaluate</code>(<strong><code>estimator</code></strong>, <strong>**<code>args</code></strong>:<a href="/job_offer_classifier/pipeline_classifier#tf_input_fn"><code>tf_input_fn</code></a>)</p>
</blockquote>
<p>Evaluate with TF <code>estimator.evaluate</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="predict" class="doc_header"><code>predict</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L121" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>predict</code>(<strong><code>estimator</code></strong>, <strong><code>df_examples</code></strong>)</p>
</blockquote>
<p>Predict with TF <code>estimator.predict</code> and from a dataframe of payloads.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Evaluate:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">eval_results</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span><span class="o">**</span><span class="n">predict_input_fn</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training set accuracy: </span><span class="si">{accuracy}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">eval_results</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test set accuracy: </span><span class="si">{accuracy}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">eval_results</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Training set accuracy: 1.0
Test set accuracy: 0.951724112033844
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Predict:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">predict</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> 
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([1, 1, 1, 1, 1])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It is desirable a predictor that inputs from a string. The function <a href="/job_offer_classifier/pipeline_classifier#sentiment"><code>sentiment</code></a> covers this role.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sentiment" class="doc_header"><code>sentiment</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L138" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sentiment</code>(<strong><code>estimator</code></strong>, <strong><code>doc</code></strong>)</p>
</blockquote>
<p>Gets the sentiment of the <em>doc</em> string</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39; thank you for offering me the position of Merchandiser with Thomas Ltd.</span>
<span class="s1">i am thankful to accept this job offer and look ahead to starting my career with your company</span>
<span class="s1">on June 27, 2000.&#39;&#39;&#39;</span>
<span class="n">sentiment</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span><span class="n">example_str</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;positive&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><em>Confusion matrix</em></strong><br>
The function <a href="/job_offer_classifier/pipeline_classifier#plot_confusion_matrix"><code>plot_confusion_matrix</code></a> plots the corresponding confusion matrix over a dataframe and its corresponding Tensorflow function. The confusion matrix helps  to understand the distribution of misclassifications.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_confusion_matrix" class="doc_header"><code>plot_confusion_matrix</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L146" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_confusion_matrix</code>(<strong><code>df_data</code></strong>, <strong><code>estimator</code></strong>, <strong><code>input_fn</code></strong>, <strong><code>header</code></strong>)</p>
</blockquote>
<p>Plot the Confusion Matrix: ${{TN,FN},{FP,TP}}$</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Confusion Matrix for the train set case</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">estimator</span><span class="p">,</span><span class="n">predict_input_fn</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">header</span><span class="o">=</span><span class="s1">&#39;Train data&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Confusion Matrix for the test case</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">estimator</span><span class="p">,</span><span class="n">predict_input_fn</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">header</span><span class="o">=</span><span class="s1">&#39;Test data&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Save-and-Load-an-Estimator">Save and Load an Estimator<a class="anchor-link" href="#Save-and-Load-an-Estimator"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The  <a href="/job_offer_classifier/pipeline_classifier#export_estimator"><code>export_estimator</code></a> function copy the directory of the estimador given in <code>estimator.model_dir</code> to a <em>dst_model</em>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="export_estimator" class="doc_header"><code>export_estimator</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L169" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>export_estimator</code>(<strong><code>estimator</code></strong>, <strong><code>dst_estimator</code></strong>)</p>
</blockquote>
<p>Copy the estimator's directory to a new directory</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Load the saved estimator using <code>load_model</code> and check that the evaluation results are up to date with latest check point:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
    <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
    <span class="n">export_estimator</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">dst_estimator</span><span class="o">=</span><span class="n">tmp_dir</span><span class="p">)</span>
    <span class="n">loaded_estimator_results</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span>
        <span class="n">load_estimator</span><span class="p">(</span><span class="n">embedded_text_feature_column</span><span class="p">,</span> <span class="n">model_dir</span><span class="o">=</span><span class="n">tmp_dir</span><span class="p">),</span>
        <span class="o">**</span><span class="n">predict_input_fn</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">loaded_estimator_results</span> <span class="o">==</span> <span class="n">eval_results</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Erase all the variables defined so far</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">del</span> <span class="n">df</span><span class="p">,</span><span class="n">dfs</span><span class="p">,</span> <span class="n">eval_results</span><span class="p">,</span> <span class="n">embedded_text_feature_column</span><span class="p">,</span> <span class="n">loaded_estimator_results</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Pipeline" class="doc_header"><code>class</code> <code>Pipeline</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L175" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Pipeline</code>(<strong><code>src_file</code></strong>=<em><code>None</code></em>, <strong><code>estimator_dir</code></strong>=<em><code>None</code></em>, <strong><code>frac</code></strong>=<em><code>0.6</code></em>, <strong><code>train_steps</code></strong>=<em><code>5000</code></em>, <strong><code>random_state</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Implements the workflow: Load -&gt; Train -&gt; Evaluate.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Pipeline.__del__" class="doc_header"><code>Pipeline.__del__</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L199" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Pipeline.__del__</code>()</p>
</blockquote>
<p>Removes the <code>estimator</code> and its corresponding directory,
unless the estimator_dir is None.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When an estimator is deleted, the corresponding temporary directory is kept in memory</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pl</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">src_file</span> <span class="o">=</span><span class="s1">&#39;../data/interim/payloads.csv&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">load_estimator</span><span class="p">()</span>
<span class="n">model_dir</span>  <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">model_dir</span>

<span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
<span class="k">del</span> <span class="n">pl</span><span class="o">.</span><span class="n">estimator</span>
<span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
<span class="n">rmtree</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The attribute <code>__del__</code>  in the <a href="/job_offer_classifier/pipeline_classifier#Pipeline"><code>Pipeline</code></a> class fixes this</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pl</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">()</span>
<span class="n">pl</span><span class="o">.</span><span class="n">load_estimator</span><span class="p">()</span>
<span class="n">model_dir</span>  <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">model_dir</span>

<span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
<span class="k">del</span> <span class="n">pl</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Exception ignored in: &lt;function Pipeline.__del__ at 0x7fefa416d830&gt;
Traceback (most recent call last):
  File &#34;&lt;ipython-input-37-88764b9b54fd&gt;&#34;, line 30, in __del__
AttributeError: &#39;Pipeline&#39; object has no attribute &#39;estimator&#39;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The deletion of the <a href="/job_offer_classifier/pipeline_classifier#Pipeline"><code>Pipeline</code></a> instance does not cause the deletion of the estimator directory when the estimator has been previously loaded (specifying it in <em>estimator_dir</em>).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
    <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">()</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">load_estimator</span><span class="p">()</span>
    <span class="n">model_dir</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">model_dir</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">export_estimator</span><span class="p">(</span><span class="n">dst_dir</span><span class="o">=</span><span class="n">tmp_dir</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">pl</span>
    
    <span class="k">assert</span> <span class="n">tmp_dir</span> <span class="o">!=</span> <span class="n">model_dir</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span> 
    <span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span>
    
    <span class="n">pl</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">estimator_dir</span><span class="o">=</span><span class="n">tmp_dir</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">pl</span> 
    
    <span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Does not generate the train TF input function when train dataframe is not provided</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sentiments</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sentiment</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sentiment&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">sentiment</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]}</span>
<span class="n">df_example_f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sentiment</span><span class="p">,</span> <span class="n">ni</span><span class="p">,</span> <span class="n">nf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">sentiments</span><span class="p">(</span><span class="n">sentiment</span><span class="p">,</span> <span class="n">nf</span> <span class="o">-</span> <span class="n">ni</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span> <span class="n">nf</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nf</span> <span class="o">-</span> <span class="n">ni</span><span class="p">)</span>

<span class="n">pl</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">()</span>
<span class="n">pl</span><span class="o">.</span><span class="n">load_estimator</span><span class="p">()</span>
<span class="n">pl</span><span class="o">.</span><span class="n">dfs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="n">df_example_f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)}</span> <span class="c1">#no tes</span>
<span class="n">pl</span><span class="o">.</span><span class="n">input_fns</span><span class="p">()</span>
<span class="k">assert</span> <span class="s1">&#39;train&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pl</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="k">assert</span> <span class="s1">&#39;test&#39;</span> <span class="ow">in</span> <span class="n">pl</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;predict&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Pipeline.pipeline" class="doc_header"><code>Pipeline.pipeline</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L261" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Pipeline.pipeline</code>()</p>
</blockquote>
<p>The pipeline flow is:
input_fns --&gt; load_estimator --&gt; train --&gt; evaluate</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>pipeline</code> calls the functions that prepares the input data, trains the model and stores the results of the evaluation</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>After running the pipeline, check that all methods are implemented correctly</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">src_file</span><span class="o">=</span> <span class="s1">&#39;../data/interim/payloads.csv&#39;</span><span class="p">)</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The resulting evaluation is stored in <code>pipeline.evaluation</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>dict_keys([&#39;train&#39;, &#39;test&#39;])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span><span class="o">.</span><span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>    
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;accuracy&#39;: 0.92413795,
 &#39;accuracy_baseline&#39;: 0.8,
 &#39;auc&#39;: 0.9784482,
 &#39;auc_precision_recall&#39;: 0.9945123,
 &#39;average_loss&#39;: 0.1516023,
 &#39;label/mean&#39;: 0.8,
 &#39;loss&#39;: 0.31074852,
 &#39;precision&#39;: 0.94871795,
 &#39;prediction/mean&#39;: 0.80659854,
 &#39;recall&#39;: 0.95689654,
 &#39;global_step&#39;: 5000,
 &#39;f1_score&#39;: 0.9527896970368303}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The confusion matrix for train set</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span><span class="o">.</span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The confustion matrix for test set</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span><span class="o">.</span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check that the <a href="/job_offer_classifier/pipeline_classifier#export_estimator"><code>export_estimator</code></a> is rightly copying the model files</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
    <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span><span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">export_estimator</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">listdir</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span> <span class="o">==</span> <span class="n">listdir</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">model_dir</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Predict examples from dataframe in 0 1 format</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([0, 1])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Predict from string</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">doc_str</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;thank you very much for offering me the opportunity to work at Norris, Wilson and Kelley as Clinical embryologist.</span><span class="se">\n</span><span class="s1">after much deliberation, i will not be accepting the position,</span>
<span class="s1">as it isnt the right fit for my long-term career goals.</span><span class="se">\n</span><span class="s1">i sincerely appreciate the offer and give you</span>
<span class="s1">my best wishes in finding a suitable candidate for the position.</span><span class="se">\n</span><span class="s1">i wish you and the company well </span>
<span class="s1">in all future endeavours.&#39;&#39;&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">sentiment</span><span class="p">(</span><span class="n">doc_str</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>negative
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Create an instance of a <a href="/job_offer_classifier/pipeline_classifier#Pipeline"><code>Pipeline</code></a> and run it (call <code>pipeline</code> method). Export the <code>estimator</code>. 
Create a new instance of a <code>pipeline</code> with the exported <code>estimator</code>. Evaluate in this pipeline without training.
The resulting evaluations of the two pipelines must coincide, provided that the <code>evaluation</code> is carried out in the same test set [CAVEAT: They must coincide up to a factor (see below)].</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">random_state</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
    <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
    <span class="n">pl1</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">src_file</span><span class="o">=</span><span class="s1">&#39;../data/interim/payloads.csv&#39;</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
    <span class="n">pl1</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span>
    <span class="n">pl1</span><span class="o">.</span><span class="n">export_estimator</span><span class="p">(</span><span class="n">dst_dir</span><span class="o">=</span><span class="n">tmp_dir</span><span class="p">)</span>
    <span class="n">pl2</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">src_file</span><span class="o">=</span><span class="s1">&#39;../data/interim/payloads.csv&#39;</span><span class="p">,</span><span class="n">estimator_dir</span><span class="o">=</span><span class="n">tmp_dir</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
    <span class="n">pl2</span><span class="o">.</span><span class="n">input_fns</span><span class="p">()</span>
    <span class="n">pl2</span><span class="o">.</span><span class="n">load_estimator</span><span class="p">()</span>
    <span class="n">pl2</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
    
<span class="k">assert</span>  <span class="n">pl1</span><span class="o">.</span><span class="n">evaluation</span> <span class="o">==</span>  <span class="n">pl2</span><span class="o">.</span><span class="n">evaluation</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Instantiate the Pipeline class twice with the same seed</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;src_file&#39;</span><span class="p">:</span> <span class="s1">&#39;../data/interim/payloads.csv&#39;</span>
<span class="p">}</span>
<span class="n">pl1</span><span class="p">,</span> <span class="n">pl2</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">Pipeline</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">pl1</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span>
<span class="n">pl2</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since the seed is the same from both pipelines, the train/test split is the same in both cases</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">pl1</span><span class="o">.</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span> <span class="o">==</span><span class="n">pl2</span><span class="o">.</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">pl1</span><span class="o">.</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">==</span><span class="n">pl2</span><span class="o">.</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Tensorflow training algorithms are not completely <a href="https://github.com/NVIDIA/tensorflow-determinism"><em>deterministic</em></a>. Therefore, the scores in the two pipelines are equal up to a factor. Calculate that factor.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">is_equal_pipe_evals</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; $error  = m 10^{-n}$</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span>
        <span class="nb">abs</span><span class="p">(</span>
            <span class="n">pl1</span><span class="o">.</span><span class="n">evaluation</span><span class="p">[</span><span class="n">dataname</span><span class="p">][</span><span class="n">scorename</span><span class="p">]</span> <span class="o">-</span>
            <span class="n">pl2</span><span class="o">.</span><span class="n">evaluation</span><span class="p">[</span><span class="n">dataname</span><span class="p">][</span><span class="n">scorename</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">&lt;</span> <span class="n">m</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">dataname</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">scorename</span> <span class="ow">in</span> <span class="n">pl1</span><span class="o">.</span><span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span>
    <span class="p">)</span>

<span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="p">):</span>
    <span class="k">if</span> <span class="n">is_equal_pipe_evals</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">break</span>
        
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The scores with different instances of the pipeline class are equal up to a factor of </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1"> x 10^(</span><span class="si">{</span><span class="o">-</span><span class="n">n</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span> 

<span class="k">assert</span> <span class="n">is_equal_pipe_evals</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The scores with different instances of the pipeline class are equal up to a factor of 4 x 10^(-2)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

