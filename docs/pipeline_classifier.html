---

title: Pipeline 

keywords: fastai
sidebar: home_sidebar

summary: "Pipeline of the text binary classifier for job offer email responses "
description: "Pipeline of the text binary classifier for job offer email responses "
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_pipeline_classifier.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The emails are classified as 'positive' or 'negative' using the Tensorflow <code>tf.estimator</code> module.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-Processing">Data Processing<a class="anchor-link" href="#Data-Processing"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The dataset of email responses is loaded from a csv file.  Three steps make up the data processing pipeline:<br>
Load the data --&gt;  Make train-test split  --&gt;  Create the Tensorflow input functions</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Load and split the data using the Pandas library.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="split_dataframe" class="doc_header"><code>split_dataframe</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L25" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>split_dataframe</code>(<strong><code>df</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Split with the pandas <code>sample</code> method.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="balanced_labels_in_split" class="doc_header"><code>balanced_labels_in_split</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L34" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>balanced_labels_in_split</code>(<strong><code>df</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Give a balanced train-test split in 'positive' and 'negative' labels</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Test these function with the following example</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sentiments</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sentiment</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sentiment&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">sentiment</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]}</span>
<span class="n">df_example_f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sentiment</span><span class="p">,</span> <span class="n">ni</span><span class="p">,</span> <span class="n">nf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">sentiments</span><span class="p">(</span><span class="n">sentiment</span><span class="p">,</span> <span class="n">nf</span> <span class="o">-</span> <span class="n">ni</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span> <span class="n">nf</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nf</span> <span class="o">-</span> <span class="n">ni</span><span class="p">)</span>
<span class="n">df_a</span> <span class="o">=</span>  <span class="n">df_example_f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span> <span class="c1"># positive</span>
<span class="n">df_b</span> <span class="o">=</span> <span class="n">df_example_f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span> <span class="c1"># negative</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">random_state</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="p">)</span>
<span class="n">split_aa</span> <span class="o">=</span> <span class="n">split_dataframe</span><span class="p">(</span><span class="n">df_a</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="n">frac</span><span class="o">=.</span><span class="mi">55</span><span class="p">)</span>
<span class="n">split_bb</span> <span class="o">=</span> <span class="n">split_dataframe</span><span class="p">(</span><span class="n">df_a</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="n">frac</span><span class="o">=.</span><span class="mi">55</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">split_aa</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">split_bb</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">split_dataframe</span><span class="p">(</span><span class="n">df_a</span><span class="p">,</span> <span class="n">frac</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">train</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">70</span> <span class="ow">and</span> <span class="n">test</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">30</span>

<span class="n">dataset</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_a</span><span class="p">,</span> <span class="n">df_b</span><span class="p">])</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">train</span><span class="p">,</span> <span class="n">test</span> <span class="o">=</span> <span class="n">balanced_labels_in_split</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">frac</span><span class="o">=.</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

<span class="k">assert</span> <span class="n">dataset</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">train</span><span class="o">.</span><span class="n">size</span> <span class="o">+</span> <span class="n">test</span><span class="o">.</span><span class="n">size</span>
<span class="k">assert</span> <span class="n">train</span><span class="o">.</span><span class="n">size</span> <span class="o">/</span> <span class="n">dataset</span><span class="o">.</span><span class="n">size</span>

<span class="n">random_state</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="p">)</span>
<span class="n">balanced1</span> <span class="o">=</span> <span class="n">balanced_labels_in_split</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="n">frac</span><span class="o">=.</span><span class="mi">65</span><span class="p">)</span>
<span class="n">balanced2</span> <span class="o">=</span> <span class="n">balanced_labels_in_split</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">,</span> <span class="n">frac</span><span class="o">=.</span><span class="mi">65</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">balanced1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">balanced2</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Tensorflow input functions are the input elements of the Tensorflow algorithms.
These functions are created with the help of the <em>version 1</em> <code>tf.estimator,inputs</code> module</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="tf_input_fn" class="doc_header"><code>tf_input_fn</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L45" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>tf_input_fn</code>(<strong><code>df</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Load a TF function for a DataFrame</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="train_input_fs" class="doc_header"><code>train_input_fs</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L52" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>train_input_fs</code>(<strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>TF functions with parameters for training</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="predict_input_fs" class="doc_header"><code>predict_input_fs</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L60" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>predict_input_fs</code>(<strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>TF with with parameters for testing</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Load and split the dataset</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../data/interim/payloads.csv&#39;</span><span class="p">)</span>
<span class="n">dfs</span> <span class="o">=</span> <span class="n">balanced_labels_in_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Percentage of the positive and negative sentiments</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sentiment_rate</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="s1">&#39;sentiment: {negative: </span><span class="si">%s</span><span class="s1">, positive: </span><span class="si">%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sentiment</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
    <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">sentiment</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">size</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dataset --&gt;&#39;</span><span class="p">,</span><span class="n">sentiment_rate</span><span class="p">(</span><span class="n">df</span><span class="p">),</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;train --&gt;&#39;</span><span class="p">,</span><span class="n">sentiment_rate</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]),</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;test --&gt;&#39;</span><span class="p">,</span><span class="n">sentiment_rate</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]),</span><span class="n">sep</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>dataset --&gt;
sentiment: {negative: 0.10055096418732783, positive: 0.39944903581267216}
train --&gt;
sentiment: {negative: 0.10091743119266056, positive: 0.39908256880733944}
test --&gt;
sentiment: {negative: 0.1, positive: 0.4}
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Sample of the train dataset</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>payload</th>
      <th>sentiment</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>282</th>
      <td>i am  keen interested to work with your orga...</td>
      <td>1</td>
    </tr>
    <tr>
      <th>227</th>
      <td>thanks for sending out the requirement for dat...</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Load Tensorflow input functions</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_input_fn</span> <span class="o">=</span> <span class="n">train_input_fs</span><span class="p">(</span><span class="n">train</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">])</span>
<span class="n">predict_input_fn</span> <span class="o">=</span>  <span class="n">predict_input_fs</span><span class="p">(</span><span class="o">**</span><span class="n">dfs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Set-up-the-Model">Set up the Model<a class="anchor-link" href="#Set-up-the-Model"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><em>Feature columns</em></strong></p>
<p>From TF-Hub <a href="https://github.com/tensorflow/hub/blob/master/docs/api_docs/python/hub/text_embedding_column.md">feature column</a>
we use <a href="https://tfhub.dev/google/nnlm-en-dim128/1">nnlm-en-dim128 module</a>. Some important facts are:</p>
<ul>
<li>The module takes <strong>a batch of sentences in a 1-D tensor of strings</strong> as input.</li>
<li>The module is responsible for <strong>preprocessing of sentences</strong> (e.g. removal of punctuation and splitting on spaces).</li>
<li>The module works with any input (e.g. <strong>nnlm-en-dim128</strong> hashes words not present in vocabulary into ~20.000 buckets).</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="embedded_text_feature_column_f" class="doc_header"><code>embedded_text_feature_column_f</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L68" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>embedded_text_feature_column_f</code>(<strong><code>module_spec</code></strong>=<em><code>'https://tfhub.dev/google/nnlm-en-dim128/1'</code></em>)</p>
</blockquote>
<p>Call the text embedding from the TF-Hub library</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Load the embedded text feature column. If it's called it for the first time, it may take time to download it (it weights around 500 MB)</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">embedded_text_feature_column</span> <span class="o">=</span> <span class="n">embedded_text_feature_column_f</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><em>Premade Estimators</em></strong></p>
<p>For classification, we use a premade <a href="https://www.tensorflow.org/api_docs/python/tf/estimator/DNNClassifier">DNN Classifier</a></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_estimator" class="doc_header"><code>load_estimator</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L76" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_estimator</code>(<strong><code>embedded_text_feature_column</code></strong>, <strong><code>estimator_f</code></strong>=<em><code>'DNNClassifierV2'</code></em>, <strong><code>model_dir</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Load the TF <code>estimator</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">estimator</span> <span class="o">=</span> <span class="n">load_estimator</span><span class="p">(</span><span class="n">embedded_text_feature_column</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When no <em>model_dir</em> is provided, the <code>estimator</code> is stored in a temporary file. A deletion of an  <code>estimator</code> (either explicit or by the garbage collector) does not erase its corresponding directory from the disk</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model_dir</span> <span class="o">=</span> <span class="n">estimator</span><span class="o">.</span><span class="n">model_dir</span>
<span class="k">del</span> <span class="n">estimator</span> 
<span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
<span class="n">rmtree</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
<span class="n">estimator</span> <span class="o">=</span> <span class="n">load_estimator</span><span class="p">(</span><span class="n">embedded_text_feature_column</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Train,-Evaluate-and-Predict">Train, Evaluate and Predict<a class="anchor-link" href="#Train,-Evaluate-and-Predict"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Train the estimator for a reasonable amount of steps.<br>
Training for 5,000 steps means 640,000 training examples with the default
batch size (128).<br>
This is roughly equivalent to 640,000/363 ~ 1700 epochs since the training dataset
contains 363 examples.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="train" class="doc_header"><code>train</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L90" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>train</code>(<strong><code>estimator</code></strong>, <strong><code>train_input_fn</code></strong>, <strong><code>steps</code></strong>=<em><code>5000</code></em>)</p>
</blockquote>
<p>Train with TF <code>estimator.train</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span><span class="n">train_input_fn</span><span class="p">,</span><span class="n">steps</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;train&#39;: &lt;tensorflow_estimator.python.estimator.canned.dnn.DNNClassifierV2 at 0x7fe45c1f0320&gt;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The F1 score is not included in <code>tf.estimator.evaluate</code>. The function <a href="/job_offer_classifier/pipeline_classifier#f1_score"><code>f1_score</code></a>, calculates the F1 score from the precision and recall. The function <a href="/job_offer_classifier/pipeline_classifier#evaluate"><code>evaluate</code></a> adds to  <code>tf.estimator.evaluate</code> the  <a href="/job_offer_classifier/pipeline_classifier#f1_score"><code>f1_score</code></a> and is acting over the input functions.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="f1_score" class="doc_header"><code>f1_score</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L99" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>f1_score</code>(<strong><code>estimations</code></strong>)</p>
</blockquote>
<p>Calculates function:</p>
<p><em>f1_score(precision,recall) =  (2 x precision x recall) / (precision + recall)</em></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">f1_score</span><span class="p">({</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">13</span><span class="p">),</span><span class="s1">&#39;recall&#39;</span><span class="p">:</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">13</span><span class="p">)})</span> <span class="o">==</span> <span class="mf">0.0</span>

<span class="k">assert</span> <span class="n">f1_score</span><span class="p">({</span><span class="s1">&#39;precision&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;recall&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>  <span class="o">==</span> <span class="mf">1.</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="evaluate" class="doc_header"><code>evaluate</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L111" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>evaluate</code>(<strong><code>estimator</code></strong>, <strong>**<code>args</code></strong>:<a href="/job_offer_classifier/pipeline_classifier#tf_input_fn"><code>tf_input_fn</code></a>)</p>
</blockquote>
<p>Evaluate with TF <code>estimator.evaluate</code></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="predict" class="doc_header"><code>predict</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L121" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>predict</code>(<strong><code>estimator</code></strong>, <strong><code>df_examples</code></strong>)</p>
</blockquote>
<p>Predict with TF <code>estimator.predict</code> and from a dataframe of payloads.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Evaluate:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">eval_results</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span><span class="o">**</span><span class="n">predict_input_fn</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training set accuracy: </span><span class="si">{accuracy}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">eval_results</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test set accuracy: </span><span class="si">{accuracy}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="n">eval_results</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Training set accuracy: 0.9908257126808167
Test set accuracy: 0.9586206674575806
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Predict:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">predict</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span> 
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([1, 1, 1, 1, 1])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It is desirable a predictor that inputs from a string. The function <a href="/job_offer_classifier/pipeline_classifier#sentiment"><code>sentiment</code></a> covers this role.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sentiment" class="doc_header"><code>sentiment</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L138" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sentiment</code>(<strong><code>estimator</code></strong>, <strong><code>doc</code></strong>)</p>
</blockquote>
<p>Gets the sentiment of the <em>doc</em> string</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">example_str</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39; thank you for offering me the position of Merchandiser with Thomas Ltd.</span>
<span class="s1">i am thankful to accept this job offer and look ahead to starting my career with your company</span>
<span class="s1">on June 27, 2000.&#39;&#39;&#39;</span>
<span class="n">sentiment</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span><span class="n">example_str</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;positive&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong><em>Confusion matrix</em></strong><br>
The function <a href="/job_offer_classifier/pipeline_classifier#plot_confusion_matrix"><code>plot_confusion_matrix</code></a> plots the corresponding confusion matrix over a dataframe and its corresponding Tensorflow function. The confusion matrix helps  to understand the distribution of misclassifications.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_confusion_matrix" class="doc_header"><code>plot_confusion_matrix</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L146" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_confusion_matrix</code>(<strong><code>df_data</code></strong>, <strong><code>estimator</code></strong>, <strong><code>input_fn</code></strong>, <strong><code>header</code></strong>)</p>
</blockquote>
<p>Plot the Confusion Matrix: ${{TN,FN},{FP,TP}}$</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Confusion Matrix for the train set case</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">estimator</span><span class="p">,</span><span class="n">predict_input_fn</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span><span class="n">header</span><span class="o">=</span><span class="s1">&#39;Train data&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Confusion Matrix for the test case</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">estimator</span><span class="p">,</span><span class="n">predict_input_fn</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">],</span><span class="n">header</span><span class="o">=</span><span class="s1">&#39;Test data&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Save-and-Load-an-Estimator">Save and Load an Estimator<a class="anchor-link" href="#Save-and-Load-an-Estimator"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The  <a href="/job_offer_classifier/pipeline_classifier#export_estimator"><code>export_estimator</code></a> function copy the directory of the estimador given in <code>estimator.model_dir</code> to a <em>dst_model</em>.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="export_estimator" class="doc_header"><code>export_estimator</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L169" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>export_estimator</code>(<strong><code>estimator</code></strong>, <strong><code>dst_estimator</code></strong>)</p>
</blockquote>
<p>Copy the estimator's directory to a new directory</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Load the saved estimator using <code>load_model</code> and check that the evaluation results are up to date with latest check point:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
    <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
    <span class="n">export_estimator</span><span class="p">(</span><span class="n">estimator</span><span class="p">,</span> <span class="n">dst_estimator</span><span class="o">=</span><span class="n">tmp_dir</span><span class="p">)</span>
    <span class="n">loaded_estimator_results</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span>
        <span class="n">load_estimator</span><span class="p">(</span><span class="n">embedded_text_feature_column</span><span class="p">,</span> <span class="n">model_dir</span><span class="o">=</span><span class="n">tmp_dir</span><span class="p">),</span>
        <span class="o">**</span><span class="n">predict_input_fn</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">loaded_estimator_results</span> <span class="o">==</span> <span class="n">eval_results</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Erase all the variables defined so far</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">del</span> <span class="n">df</span><span class="p">,</span><span class="n">dfs</span><span class="p">,</span> <span class="n">eval_results</span><span class="p">,</span> <span class="n">embedded_text_feature_column</span><span class="p">,</span> <span class="n">loaded_estimator_results</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">str</span><span class="p">(</span><span class="s1">&#39;hola this is an string&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;hola this is an string&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Pipeline" class="doc_header"><code>class</code> <code>Pipeline</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L175" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Pipeline</code>(<strong><code>src_file</code></strong>=<em><code>None</code></em>, <strong><code>estimator_dir</code></strong>=<em><code>None</code></em>, <strong><code>frac</code></strong>=<em><code>0.6</code></em>, <strong><code>train_steps</code></strong>=<em><code>5000</code></em>, <strong><code>random_state</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Implements the workflow: Load -&gt; Train -&gt; Evaluate.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Pipeline.__del__" class="doc_header"><code>Pipeline.__del__</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L200" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Pipeline.__del__</code>()</p>
</blockquote>
<p>Removes the <code>estimator</code> and its corresponding directory,
unless the estimator_dir is None.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When an estimator is deleted, the corresponding temporary directory is kept in memory</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pl</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">src_file</span> <span class="o">=</span><span class="s1">&#39;../data/interim/payloads.csv&#39;</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">load_estimator</span><span class="p">()</span>
<span class="n">model_dir</span>  <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">model_dir</span>

<span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
<span class="k">del</span> <span class="n">pl</span><span class="o">.</span><span class="n">estimator</span>
<span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
<span class="n">rmtree</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The attribute <code>__del__</code>  in the <a href="/job_offer_classifier/pipeline_classifier#Pipeline"><code>Pipeline</code></a> class fixes this</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pl</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">()</span>
<span class="n">pl</span><span class="o">.</span><span class="n">load_estimator</span><span class="p">()</span>
<span class="n">model_dir</span>  <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">model_dir</span>

<span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
<span class="k">del</span> <span class="n">pl</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The deletion of the <a href="/job_offer_classifier/pipeline_classifier#Pipeline"><code>Pipeline</code></a> instance does not cause the deletion of the estimator directory when the estimator has been previously loaded (specifying it in <em>estimator_dir</em>).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
    <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">()</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">load_estimator</span><span class="p">()</span>
    <span class="n">model_dir</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">model_dir</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">export_estimator</span><span class="p">(</span><span class="n">dst_dir</span><span class="o">=</span><span class="n">tmp_dir</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">pl</span>
    
    <span class="k">assert</span> <span class="n">tmp_dir</span> <span class="o">!=</span> <span class="n">model_dir</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">model_dir</span><span class="p">)</span> 
    <span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span>
    
    <span class="n">pl</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">estimator_dir</span><span class="o">=</span><span class="n">tmp_dir</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">pl</span> 
    
    <span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span>
    
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Does not generate the train TF input function when train dataframe is not provided</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sentiments</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sentiment</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sentiment&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">sentiment</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]}</span>
<span class="n">df_example_f</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">sentiment</span><span class="p">,</span> <span class="n">ni</span><span class="p">,</span> <span class="n">nf</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">sentiments</span><span class="p">(</span><span class="n">sentiment</span><span class="p">,</span> <span class="n">nf</span> <span class="o">-</span> <span class="n">ni</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span> <span class="n">nf</span><span class="p">)</span>
<span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nf</span> <span class="o">-</span> <span class="n">ni</span><span class="p">)</span>

<span class="n">pl</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">()</span>
<span class="n">pl</span><span class="o">.</span><span class="n">load_estimator</span><span class="p">()</span>
<span class="n">pl</span><span class="o">.</span><span class="n">dfs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="n">df_example_f</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)}</span> <span class="c1">#no tes</span>
<span class="n">pl</span><span class="o">.</span><span class="n">input_fns</span><span class="p">()</span>
<span class="k">assert</span> <span class="s1">&#39;train&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">pl</span><span class="o">.</span><span class="n">input</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="k">assert</span> <span class="s1">&#39;test&#39;</span> <span class="ow">in</span> <span class="n">pl</span><span class="o">.</span><span class="n">input</span><span class="p">[</span><span class="s1">&#39;predict&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Pipeline.pipeline" class="doc_header"><code>Pipeline.pipeline</code><a href="https://github.com/kikejimenez/job_offer_classifier/tree/master/job_offer_classifier/pipeline_classifier.py#L263" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Pipeline.pipeline</code>()</p>
</blockquote>
<p>The pipeline flow is:
input_fns --&gt; load_estimator --&gt; train --&gt; evaluate</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>pipeline</code> calls the functions that prepares the input data, trains the model and stores the results of the evaluation</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>After running the pipeline, check that all methods are implemented correctly</strong></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">src_file</span><span class="o">=</span> <span class="s1">&#39;../data/interim/payloads.csv&#39;</span><span class="p">)</span>
<span class="n">pipeline</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The resulting evaluation is stored in <code>pipeline.evaluation</code></p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span><span class="o">.</span><span class="n">evaluation</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>dict_keys([&#39;train&#39;, &#39;test&#39;])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span><span class="o">.</span><span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>    
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;accuracy&#39;: 0.92413795,
 &#39;accuracy_baseline&#39;: 0.8,
 &#39;auc&#39;: 0.9784482,
 &#39;auc_precision_recall&#39;: 0.9945123,
 &#39;average_loss&#39;: 0.1516023,
 &#39;label/mean&#39;: 0.8,
 &#39;loss&#39;: 0.31074852,
 &#39;precision&#39;: 0.94871795,
 &#39;prediction/mean&#39;: 0.80659854,
 &#39;recall&#39;: 0.95689654,
 &#39;global_step&#39;: 5000,
 &#39;f1_score&#39;: 0.9527896970368303}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The confusion matrix for train set</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span><span class="o">.</span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The confustion matrix for test set</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span><span class="o">.</span><span class="n">plot_confusion_matrix</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Check that the <a href="/job_offer_classifier/pipeline_classifier#export_estimator"><code>export_estimator</code></a> is rightly copying the model files</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
    <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span><span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">export_estimator</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span>
    
    <span class="k">assert</span> <span class="n">listdir</span><span class="p">(</span><span class="n">tmp_dir</span><span class="p">)</span> <span class="o">==</span> <span class="n">listdir</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">estimator</span><span class="o">.</span><span class="n">model_dir</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Predict examples from dataframe in 0 1 format</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([0, 1])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Predict from string</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">doc_str</span><span class="o">=</span><span class="s1">&#39;&#39;&#39;thank you very much for offering me the opportunity to work at Norris, Wilson and Kelley as Clinical embryologist.</span><span class="se">\n</span><span class="s1">after much deliberation, i will not be accepting the position,</span>
<span class="s1">as it isn’t the right fit for my long-term career goals.</span><span class="se">\n</span><span class="s1">i sincerely appreciate the offer and give you</span>
<span class="s1">my best wishes in finding a suitable candidate for the position.</span><span class="se">\n</span><span class="s1">i wish you and the company well </span>
<span class="s1">in all future endeavours.&#39;&#39;&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pipeline</span><span class="o">.</span><span class="n">sentiment</span><span class="p">(</span><span class="n">doc_str</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>negative
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Create an instance of a <a href="/job_offer_classifier/pipeline_classifier#Pipeline"><code>Pipeline</code></a> and run it (call <code>pipeline</code> method). Export the <code>estimator</code>. 
Create a new instance of a <code>pipeline</code> with the exported <code>estimator</code>. Evaluate in this pipeline without training.
The resulting evaluations of the two pipelines must coincide, provided that the <code>evaluation</code> is carried out in the same test set [CAVEAT: They must coincide up to a factor (see below)].</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">random_state</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
    <span class="n">tmp_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmpdirname</span><span class="p">,</span> <span class="s1">&#39;tmp&#39;</span><span class="p">)</span>
    <span class="n">pl1</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">src_file</span><span class="o">=</span><span class="s1">&#39;../data/interim/payloads.csv&#39;</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
    <span class="n">pl1</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span>
    <span class="n">pl1</span><span class="o">.</span><span class="n">export_estimator</span><span class="p">(</span><span class="n">dst_dir</span><span class="o">=</span><span class="n">tmp_dir</span><span class="p">)</span>
    <span class="n">pl2</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">src_file</span><span class="o">=</span><span class="s1">&#39;../data/interim/payloads.csv&#39;</span><span class="p">,</span><span class="n">estimator_dir</span><span class="o">=</span><span class="n">tmp_dir</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
    <span class="n">pl2</span><span class="o">.</span><span class="n">input_fns</span><span class="p">()</span>
    <span class="n">pl2</span><span class="o">.</span><span class="n">load_estimator</span><span class="p">()</span>
    <span class="n">pl2</span><span class="o">.</span><span class="n">evaluate</span><span class="p">()</span>
    
<span class="k">assert</span>  <span class="n">pl1</span><span class="o">.</span><span class="n">evaluation</span> <span class="o">==</span>  <span class="n">pl2</span><span class="o">.</span><span class="n">evaluation</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Instantiate the Pipeline class twice with the same seed</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
    <span class="s1">&#39;src_file&#39;</span><span class="p">:</span> <span class="s1">&#39;../data/interim/payloads.csv&#39;</span>
<span class="p">}</span>
<span class="n">pl1</span><span class="p">,</span> <span class="n">pl2</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">),</span> <span class="n">Pipeline</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">pl1</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span>
<span class="n">pl2</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since the seed is the same from both pipelines, the train/test split is the same in both cases</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">pl1</span><span class="o">.</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span> <span class="o">==</span><span class="n">pl2</span><span class="o">.</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">pl1</span><span class="o">.</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span> <span class="o">==</span><span class="n">pl2</span><span class="o">.</span><span class="n">dfs</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Tensorflow training algorithms are not completely <a href="https://github.com/NVIDIA/tensorflow-determinism"><em>deterministic</em></a>. Therefore, the scores in the two pipelines are equal up to a factor. Calculate that factor.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">is_equal_pipe_evals</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; $error  = m 10^{-n}$</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">all</span><span class="p">(</span>
        <span class="nb">abs</span><span class="p">(</span>
            <span class="n">pl1</span><span class="o">.</span><span class="n">evaluation</span><span class="p">[</span><span class="n">dataname</span><span class="p">][</span><span class="n">scorename</span><span class="p">]</span> <span class="o">-</span>
            <span class="n">pl2</span><span class="o">.</span><span class="n">evaluation</span><span class="p">[</span><span class="n">dataname</span><span class="p">][</span><span class="n">scorename</span><span class="p">]</span>
        <span class="p">)</span> <span class="o">&lt;</span> <span class="n">m</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">dataname</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">scorename</span> <span class="ow">in</span> <span class="n">pl1</span><span class="o">.</span><span class="n">evaluation</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">]</span>
    <span class="p">)</span>

<span class="k">for</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="p">):</span>
    <span class="k">if</span> <span class="n">is_equal_pipe_evals</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">break</span>
        
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The scores with different instances of the pipeline class are equal up to a factor of </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1"> x 10^(</span><span class="si">{</span><span class="o">-</span><span class="n">n</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span> 

<span class="k">assert</span> <span class="n">is_equal_pipe_evals</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The scores with different instances of the pipeline class are equal up to a factor of 4 x 10^(-2)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

